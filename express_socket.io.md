# Socket.io

Socket.ioê°€ ë¬´ì—‡ì¸ì§€, ì–´ë–¤ ê¸°ëŠ¥ì— í™œìš©ë˜ëŠ”ì§€ ê³µë¶€í•©ë‹ˆë‹¤.

## ì‹œì‘ì— ì•ì„œ ì•Œì•„ì•¼í•  ë¶€ë¶„

### TCPì™€ UDP

> `TCPë€?`  
> ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ ë°ì´í„° ì†¡ìˆ˜ì‹ ì„ ìœ„í•´ ë§Œë“¤ì–´ì§„ í”„ë¡œí† ì½œ  
> `ì—°ê²° ì§€í–¥ì„± í”„ë¡œí† ì½œ`ì´ë¼ê³ ë„ ë¶€ë¥´ëŠ”ë° ê·¸ ì´ìœ ëŠ” ì„œë²„ì™€ í´ë¼ì´ì–¸íŠ¸ê°€ ì–‘ë°©í–¥ìœ¼ë¡œ ì†Œí†µí•¨ìœ¼ë¡œì„œ ë°ì´í„° ìš”ì²­ ë° ì „ì†¡ì— ìˆì–´ ì°¨ì§ˆì´ ì—†ë„ë¡ í•˜ì—¬ ë°ì´í„°ì˜ ëˆ„ë½ ë˜ëŠ” ìˆœì„œê°€ ë’¤ë°”ë€ŒëŠ” ì¼ì„ ë°©ì§€í•˜ëŠ” ê²ƒ, ì¦‰ í†µì‹ ì˜ ì•ˆì •ì„±ì„ ë°”íƒ•ìœ¼ë¡œ í•œ ì‹ ë¢°ì— ì¤‘ì ì„ ë‘ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.  
> ê°€ë ¹ í´ë¼ì´ì–¸íŠ¸ê°€ ë°ì´í„°ë¥¼ ìš”ì²­í–ˆê³ , ì„œë²„ê°€ ë³´ë‚´ì£¼ëŠ” ê³¼ì •ì—ì„œ ë°ì´í„°ê°€ ëˆ„ë½ë˜ì—ˆë‹¤ë©´ í´ë¼ì´ì–¸íŠ¸ì—ì„œ "ëˆ„ë½ëë‹¤."ë¼ê³  ì•Œë ¤ì£¼ë©´ ì„œë²„ê°€ ë‹¤ì‹œ ë³´ë‚´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ ì„œë¡œ ì†Œí†µí•˜ë¯€ë¡œ ì•„ë¬´ë˜ë„ ë°ì´í„° ì „ì†¡ì´ ì˜ëª»ëœ ê°€ëŠ¥ì„±ì´ í˜„ì €íˆ ë‚®ì•„ ì‹ ë¢°ê°€ ë†’ì•„ì§‘ë‹ˆë‹¤.  
> í•˜ì§€ë§Œ UDPì™€ ë¹„êµí–ˆì„ ë•Œ ì „ì†¡ ì†ë„ê°€ ëŠë¦½ë‹ˆë‹¤. ì™œ ê·¸ëŸ´ê¹Œìš”?

> `UDPë€?`  
> TCPì™€ ë¹„êµí–ˆì„ ë•Œ "ì „í˜€ ì†Œí†µí•˜ì§€ ì•ŠëŠ”ë‹¤." ë¼ê³  ìƒê°í•˜ì‹œë©´ ì´í•´í•˜ê¸° ì‰¬ìš¸ ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì¦‰ ì„œë²„ëŠ” ë˜ì§€ê³ , í´ë¼ì´ì–¸íŠ¸ëŠ” ë°›ëŠ” ê³¼ì •ì—ì„œ TCPì™€ ê°™ì€ ì†Œí†µì´ ì—†ìŠµë‹ˆë‹¤. ê·¸ëŸ¬ë‹ˆê¹Œ ë°ì´í„°ê°€ ëˆ„ë½ë˜ê±°ë‚˜, ì „ì†¡ ìˆœì„œê°€ ë°”ë€Œê±°ë‚˜í•´ì„œ ì˜¨ì „í•œ ë°ì´í„°ë¥¼ ì „ë‹¬í•´ì¤„ê±°ë€ ì‹ ë¢°ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ë°–ì— ì—†ìŠµë‹ˆë‹¤. ì™œëƒí•˜ë©´ í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì„±ê³µìœ ë¬´ì— ëŒ€í•œ í”¼ë“œë°±ì„ ë°›ëŠ” êµ¬ì¡°ê°€ ì•„ë‹ˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.  
> í•˜ì§€ë§Œ ì•„ë¬´ë˜ë„ ì „ì†¡ì†ë„ê°€ ë¹ ë¥¼ ìˆ˜ ë°–ì— ì—†ê² ì£ . ì†Œí†µì— í•„ìš”í•œ ì§€ì—°ì‹œê°„ì´ ì—†ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. ì´ëŠ” ê²½ìš°ì— ë”°ë¼ì„œ TCPë³´ë‹¤ ìœ ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì „ì†¡ ë¹„ìš©ì´ ì ë‹¤ëŠ” ê²ƒì—ì„œ ì–»ëŠ” ì´ì ë“¤ì´ ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

## What is Socket?

ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°ì´í„°ë¥¼ ì†¡ìˆ˜ì‹ í•˜ê¸° ìœ„í•´ ë°˜ë“œì‹œ ê±°ì³ì•¼ í•˜ëŠ” ì—°ê²°ë¶€ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ê°€ì „ì œí’ˆì„ ì—°ê²°í•˜ëŠ” ì½˜ì„¼íŠ¸ ì¢…ë¥˜(110v, 220v)ë¥¼ ë– ì˜¬ë¦¬ë©´ ë  ê²ƒ ê°™ìŠµë‹ˆë‹¤. ì•ì„œ ì–¸ê¸‰í•œ TCPì™€ UDPê°€ ì†Œì¼“ì— í•´ë‹¹í•©ë‹ˆë‹¤.

## íŒ¨í‚·(Packet)?

ì½˜ì„¼íŠ¸ì— ê°€ì „ì œí’ˆì„ ì—°ê²°í•´ì„œ ì‘ë™ì‹œí‚¤ë©´ ì „ê¸° ì‹ í˜¸ê°€ íë¥´ê²Œ ë˜ëŠ” ê²ƒê³¼ ê°™ì´ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì„ í†µí•´ íë¥´ëŠ” ë°ì´í„°ì˜ ë‹¨ìœ„ë¥¼ íŒ¨í‚·ì´ë¼ê³  í•©ë‹ˆë‹¤.

## ì›¹ì†Œì¼“(WebSocket)?

ì‹¤ì‹œê°„ ì›¹ ì„œë¹„ìŠ¤ ì œê³µì„ ìœ„í•œ ì†Œì¼“ì…ë‹ˆë‹¤. ì´ëŠ” ì£¼ë¡œ ì‹¤ì‹œê°„ ì†Œí†µì´ í•„ìš”í•œ í™˜ê²½ì— ì ìš©ë˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤. ê°€ë ¹ êµ¬ê¸€ Docs ë˜ëŠ” ë©”ì‹ ì € ë“± ì‹¤ì‹œê°„ ê³µë™ í¸ì§‘ì´ ê°€ëŠ¥í•œ ê¸°ìˆ ì— ì ìš©ë©ë‹ˆë‹¤.  
í•˜ì§€ë§Œ ì›¹ì†Œì¼“ì´ ëª¨ë“  ë¸Œë¼ìš°ì €ì— ëŒ€í•´ì„œ ë™ì‘ì„ ë³´ì¥í•˜ì§€ëŠ” ì•Šê¸° ë•Œë¬¸ì— MDNì—ì„œ ì›¹ì†Œì¼“ì˜ í˜¸í™˜ì„±ì„ ê³ ë ¤í•  í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤. ì´ ë¬¸ì œë¥¼ ë³´ì™„í•˜ê¸° ìœ„í•´ ë‚˜ì˜¨ ê²ƒì´ Socket.ioì…ë‹ˆë‹¤.

## socket.io?

ìë°”ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì›¹ì†Œì¼“ êµ¬í˜„ ì‹œ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì…ë‹ˆë‹¤.  
socket.ioëŠ” ì‹¤ì‹œê°„ ê¸°ëŠ¥ êµ¬í˜„ì— ìˆì–´ ëª¨ë“  ì‚¬ìš©ìë¥¼ ê³ ë ¤í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ”ë°, íŠ¹íˆ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ì¼ì • ê°„ê²©ë§ˆë‹¤ ë°›ì•„ì˜¤ëŠ” polling ê¸°ëŠ¥ìœ¼ë¡œ ì‹¤ì‹œê°„ ê¸°ëŠ¥ êµ¬í˜„ì„ ê°€ëŠ¥ì¼€ ë„ì™€ì£¼ëŠ” ê²ƒì´ í•˜ë‚˜ì˜ ì˜ˆì‹œë¡œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### socket.io ì‹¤ìŠµ

#### íŒ¨í‚¤ì§€ ì„¤ì¹˜

```javascript
npm install socket.io -S
```

---

#### Socket.io ê¸°ë³¸ ì„¤ì •

```javascript
// app.js
const express = require('express');
const { Server } = require('http');
const socketIo = require('socket.io');

const app = express();
const http = Server(app);
const io = socketIo(http, {
  // cors: ì†Œì¼“ì˜ ì ‘ê·¼ ê°€ëŠ¥ ìœ ì €ë‚˜ methodë¥¼ ì œí•œí•©ë‹ˆë‹¤.
  cors: {
    origin: '*',
    methods: ['GET', 'POST'],
  },
});
const port = 3000;

// ìœ ì €ê°€ ì„œë²„ì— ì ‘ì†í•˜ë©´ ì†Œì¼“ì„ ì—°ê²°í•©ë‹ˆë‹¤.
io.on('connection', (socket) => {
  console.log('ìƒˆë¡œìš´ ì†Œì¼“ì´ ì—°ê²°ëì–´ìš”!');
});

app.use(express.json());
app.use(express.urlencoded({ extended: false }));
// app.use(cookieParser());
app.use(express.static('assets'));

app.get('/', (req, res) => {
  res.send('Hello');
}); //

http.listen(POST, () => {
  console.log(POST, 'í¬íŠ¸ì— ì ‘ì†í–ˆìŠµë‹ˆë‹¤.');
});
```

í´ë¼ì´ì–¸íŠ¸ì™€ì˜ socketì„ í†µí•œ í†µì‹ ì„ ìœ„í•´ì„œëŠ” ì´ì „ê³¼ ë‹¤ë¥¸ app.js ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.  
ì¶”ê°€ëœ ë¶€ë¶„ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

- `http` íŒ¨í‚¤ì§€ì—ì„œ `Server` ê°ì²´ë¥¼ ê°€ì ¸ì™€ express íŒ¨í‚¤ì§€ì¸ appì„ ê°ì‹¸ì£¼ê³  ì´ë¥¼ ë˜ ë‹¤ì‹œ `socketIo`ë©”ì„œë“œë¡œ ê°ì‹¸ì¤ë‹ˆë‹¤.
- ì´ì œ app.listenì´ ì•„ë‹Œ http.listenìœ¼ë¡œ ì„œë²„ ì ‘ì† ì½”ë“œë¥¼ ë³€ê²½í•©ë‹ˆë‹¤.
- `io.on`ì„ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì™€ ì„œë²„ê°„ ì†Œì¼“ í†µì‹ ì„ ì¤€ë¹„í•©ë‹ˆë‹¤.

> ì½”ë“œ ì„¤ëª…  
> io.on ë©”ì„œë“œì— 'connection' í…ìŠ¤íŠ¸ë¥¼ ì…ë ¥í•˜ë©´ ì†Œì¼“ ì—°ê²° ì‹œ ì½œë°±í•¨ìˆ˜ë¥¼ ìˆ˜í–‰í•˜ê² ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.  
> í˜„ì¬ëŠ” `console.log('ìƒˆë¡œìš´ ì†Œì¼“ì´ ì—°ê²°ëì–´ìš”!')` ê¸°ëŠ¥ë°–ì— ì—†ìœ¼ë¯€ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì ‘ì†í•  ë•Œë§ˆë‹¤ í•´ë‹¹ ë¬¸êµ¬ê°€ ì„œë²„ í„°ë¯¸ë„ì— ê¸°ë¡ë©ë‹ˆë‹¤.
> ì´ëŠ” socketì´ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ ì„ ì£¼ê³  ë°›ìŠµë‹ˆë‹¤.

> ğŸš¨ `ì£¼ì˜`  
> `assets` í´ë”ê°€ `express.static`ìœ¼ë¡œ ë“±ë¡ë˜ì–´ ìˆìœ¼ë¯€ë¡œ `app.get('/')` ì¦‰ ë£¨íŠ¸ ê²½ë¡œì˜ GET ìš”ì²­ ì‹œ assets í´ë” ë‚´ index.htmlì„ ìë™ìœ¼ë¡œ í´ë¼ì´ì–¸íŠ¸ì— ì¶œë ¥í•©ë‹ˆë‹¤.  
> ì´ëŠ” node expressì˜ íŠ¹ì„± ìƒ index íŒŒì¼ì„ ê°€ì¥ ë¨¼ì € ì°¾ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.  
> ë§Œì•½ assets í´ë”ê°€ staticìœ¼ë¡œ ë“±ë¡ë˜ì§€ ì•Šì„ ê²½ìš° ë£¨íŠ¸ ê²½ë¡œì˜ GETì€ 'hello' í…ìŠ¤íŠ¸ë¥¼ í”„ë¡ íŠ¸ì— ì „ë‹¬í•˜ê²Œ ë©ë‹ˆë‹¤.

---

#### Socket í†µì‹ 

ìœ„ì—ì„œ ì‘ì„±í•œ io.onì„ í†µí•´ ë³¸ê²©ì ìœ¼ë¡œ ì„œë²„-í´ë¼ì´ì–¸íŠ¸ ê°„ í†µì‹ ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.  
í†µì‹  ì˜ˆì‹œë¥¼ ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤.

```javascript
// ìœ ì €ê°€ ì„œë²„ì— ì ‘ì†í•˜ë©´ ì†Œì¼“ì„ ì—°ê²°í•©ë‹ˆë‹¤.
io.on('connection', (socket) => {
  // console.log('ìƒˆë¡œìš´ ì†Œì¼“ì´ ì—°ê²°ëì–´ìš”!');

  // ì†Œì¼“ ì‚¬ìš©ì ì ‘ì† ì‹œ ë°”ë¡œ ì‹¤í–‰
  socket.emit('BUY_GOODS', {
    nickname: 'ì„œë²„ê°€ ë³´ë‚´ì¤€ êµ¬ë§¤ì ë‹‰ë„¤ì„',
    goodsId: 10,
    goodsName: 'ì„œë²„ê°€ ë³´ë‚´ì¤€ ìƒí’ˆëª…',
    date: 'êµ¬ë§¤ ì¼ì‹œ',
  });

  socket.on('BUY', (data) => {
    console.log('êµ¬ë§¤í•œ ì •ë³´ì…ë‹ˆë‹¤.');
    console.log(data);
  });
});
```

socketì„ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ” ì½œë°± í•¨ìˆ˜ì—ì„œ `emit`ë©”ì„œë“œëŠ” ë³´ë‚¼ ë•Œ, `on`ì€ ë°›ì„ ë•Œë¼ê³  ìƒê°í•˜ë©´ ë©ë‹ˆë‹¤.  
emit ë©”ì„œë“œì—ì„œ 'BUY_GOODS' ëŠ” ì¼ì¢…ì˜ ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆì˜ ë„¤ì„ê³¼ ê°™ì€ ì¡´ì¬ì…ë‹ˆë‹¤. í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì ‘ì† ì‹œ socketì´ ì—°ê²°ë˜ë©´  
ê·¸ ì¦‰ì‹œ 'BUY_GOODS'ë¼ëŠ” ì´ë¦„ì˜ ì´ë²¤íŠ¸ë¥¼ í´ë¼ì´ì–¸íŠ¸ì— ë³´ëƒ„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.  
ë˜í•œ on ë©”ì„œë“œì˜ ê²½ìš° í´ë¼ì´ì–¸íŠ¸ì—ì„œ 'BUY'ë¼ëŠ” ì´ë²¤íŠ¸ë¥¼ ë°›ê²Œ ëœë‹¤ë©´ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

> ğŸš¨ `ì£¼ì˜`  
> í˜„ì¬ io.on ë‚´ë¶€ì˜ socket íŒŒë¼ë¯¸í„°ë¡œ í†µì‹ ì´ ë˜ê³  ìˆìœ¼ë©° ì´ëŠ” í´ë¼ì´ì–¸íŠ¸ ì„œë²„ ê°„ 1:1 í†µì‹ ì„ í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.  
> ê·¸ëŸ¬ë¯€ë¡œ ë§Œì•½ ë‹¤ : 1ë¡œ í†µì‹ ì„ í•˜ê¸° ìœ„í•´ì„œëŠ” io.emit ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ í˜„ì¬ ì„œë²„ì— ì ‘ì†í•œ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

#### í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ

í´ë¼ì´ì–¸íŠ¸ì—ì„œëŠ” socketë¥¼ ì–´ë–»ê²Œ ë°›ì•„ë“¤ì´ëŠ”ì§€ í™•ì¸í•©ë‹ˆë‹¤.

```html
<!-- index.html -->
<script src="https://cdn.socket.io/socket.io-3.0.1.min.js"></script>
<script>
  const socket = io.connect('/'); // ìœ„ scriptê°€ ì—°ê²°ë˜ì–´ì•¼ ioê°€ ë™ì‘í•¨

  socket.on('BUY_GOODS', function (data) {
    const { nickname, goodsId, goodsName, date } = data;
    makeBuyNotification(nickname, goodsName, goodsId, date);
  });
</script>
```

ì„œë²„ì—ì„œ ë³´ë‚¸ 'BUY_GOODS' ì´ë²¤íŠ¸ë¥¼ index.htmlì—ì„œ on ë©”ì„œë“œë¥¼ í†µí•´ ë°›ì•„ ì½œë°±í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.  
ì˜ˆì‹œë¥¼ ë³´ì‹œë©´ ì„œë²„ë¡œë¶€í„° ì „ë‹¬ ë°›ì€ ì •ë³´ë¥¼ `data`ë¼ëŠ” íŒŒë¼ë¯¸í„°ë¡œ ë°›ê³  ìˆìœ¼ë©° ì´ë¥¼ í† ëŒ€ë¡œ `êµ¬ë§¤ ì•Œë¦¼ì°½`ì„ ë„ì›Œì£¼ëŠ” í•¨ìˆ˜ì— ì ìš©ë˜ì–´ ì‹¤í–‰ëœë‹¤ëŠ” ê²ƒì„ ì˜ˆìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
í˜„ì¬ ì„œë²„ì—ì„œëŠ” ì†Œì¼“ì´ ì—°ê²°ë§Œ ë˜ë©´ ë¬´ì¡°ê±´ 'BUY_GOODS' ì´ë²¤íŠ¸ë¥¼ emití•˜ë¯€ë¡œ ìœ ì €ëŠ” index.htmlì— ì ‘ì†í•  ë•Œ ë§ˆë‹¤ 'BUY_GOODS' ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ë  ê²ƒì…ë‹ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ ì„œë²„ì—ì„œ ë³´ë‚¼ ë•ŒëŠ” ì–´ë–»ê²Œ í™œìš©ë ê¹Œìš”?

```javascript
function postOrder(user, order) {
  if (!order.length) {
    return;
  }

  socket.emit('BUY', {
    nickname: user.nickname,
    goodsId: order[0].goods.goodsId,
    goodsName:
      order.length > 1
        ? `${order[0].goods.name} ì™¸ ${order.length - 1}ê°œì˜ ìƒí’ˆ`
        : order[0].goods.name,
  });
}
```

ìœ„ ì˜ˆì‹œëŠ” êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ ì‹œ postOrder í•¨ìˆ˜ê°€ ìˆ˜í–‰ë¨ì„ ê°€ì •í•˜ê³  ìˆìŠµë‹ˆë‹¤.  
êµ¬ë§¤ ë²„íŠ¼ í´ë¦­ ì‹œ ìœ ì € ì •ë³´ë¥¼ ì˜¤ë¸Œì íŠ¸ì— ë‹´ì•„ ì„œë²„ì˜ 'BUY' ì´ë²¤íŠ¸ë¡œ ì „ë‹¬(emit)í•©ë‹ˆë‹¤.  
ê·¸ëŸ¬ë©´ ì„œë²„ì—ì„œ êµ¬ë§¤ìì˜ ì •ë³´ë¥¼ ë°›ê²Œ ë©ë‹ˆë‹¤.

#### íŠ¹ì • ìœ ì €ê°€ êµ¬ë§¤í–ˆì„ ë•Œ ëª¨ë“  ìœ ì €ì—ê²Œ ì•Œë¦¼ ë©”ì‹œì§€ë¥¼ ì „ë‹¬í•œë‹¤ë©´??

íŠ¹ì • ìœ ì €ê°€ ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ ëª¨ë“  ìœ ì € ëŒ€ìƒìœ¼ë¡œ emitì„ í•  ìˆ˜ë„ ìˆì„ ê²ƒì´ë‹¤.

```javascript
socket.on('BUY', (data) => {
  const { nickname, goodsId, goodsName } = data;

  const emitData = {
    nickname,
    goodsId,
    goodsName,
    date: new Date().toISOString(), // í˜„ì¬ ì‹œê°
  };

  io.emit('BUY_GOODS', emitData);
});
```

ëˆ„êµ°ê°€ê°€ êµ¬ë§¤í•œ ê²°ê³¼ë¥¼ ë°ì´í„°ë¡œ ë°›ì€ ë’¤ í˜„ì¬ ì‹œê° ì •ë³´ë¥¼ ì¶”ê°€í•˜ì—¬ io.emit ì´ë²¤íŠ¸ë¡œ ë³´ë‚´ê³  ìˆë‹¤.  
ì—¬ê¸°ì„œ ê¸°ì–µí•  ì ì€ `io.emit`ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ë°œìƒì‹œí‚¤ë©´ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ì—ê²Œ ì „ë‹¬ëœë‹¤ëŠ” ì ì´ë‹¤.

---

#### socketì„ ì´ìš©í•œ ì£¼ë¬¸ í˜ì´ì§€ ì½”ë“œ ì¼ë¶€ ì‚´í´ë³´ê¸°

```html
<!-- order.html -->
<script>
  $(document).ready(function () { // orderí˜ì´ì§€ ë¡œë“œ í›„ ì‹¤í–‰í•  í•¨ìˆ˜ ë“±ë¡ (jquery)

    getSelf(function (user) {
      const order = JSON.parse(sessionStorage.getItem("ordered"));
      $("#nickname").text(user.nickname);
      $("#btnOrder")
        .text(
          `$${number2decimals( // ì†Œìˆ˜ ë³€í™˜ê¸°
            order.reduce(
              (s, o) => s + Number(o.goods.price) * o.quantity,
              0
            )
          )} ê²°ì œ`
        )
        .click(function () {
          postOrder(user, order);
        });
      $(".btn-confirm").click(function () {
        location.href = "/goods.html";
      });
    });
  });

  function number2decimals(num) {
    return (Math.round(num * 100) / 100).toFixed(2);
  }
</script>
```

getSelfí•¨ìˆ˜ë¥¼ í†µí•´ ë°›ì€ ìœ ì € ì •ë³´ë¥¼ í† ëŒ€ë¡œ íŠ¹ì • íƒœê·¸ì— valueë¥¼ ì ìš©í•˜ê³  ìˆì–´ í”„ë¡ íŠ¸ ì˜ì—­ì— ë³€í™”ë¥¼ ì£¼ëŠ” ê²ƒ ê°™ë‹¤.  
ê·¸ ì¤‘ ê²°ì œ ë²„íŠ¼ í´ë¦­ ì‹œ ì ìš©ë˜ì–´ì•¼ í•  postOrder í•¨ìˆ˜ì˜ íŒŒë¼ë¯¸í„°ë¡œ í•´ë‹¹ ìœ ì € ì •ë³´ë¥¼ ë‹´ì•„ click ì´ë²¤íŠ¸ë¥¼ ë“±ë¡í•œë‹¤.  
ê·¸ë ‡ë‹¤ë©´ getSelf í•¨ìˆ˜ëŠ” ì–´ë–¤ í•¨ìˆ˜ì¼ê¹Œ?? ìœ ì € ì •ë³´ë¥¼ í”„ë¡ íŠ¸ì— ì ìš©í•˜ëŠ” í•¨ìˆ˜ê°€ íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ê°€ë¯€ë¡œ getSelfì˜ ì½œë°± í•¨ìˆ˜ë¡œ ì‚¬ìš©ë  ê²ƒìœ¼ë¡œ ì˜ˆìƒëœë‹¤.

```javascript
function getSelf(callback) {
  $.ajax({
    type: 'GET',
    url: '/api/users/me',
    success: function (response) {
      callback(response.user);
    },
    error: function (xhr, status, error) {
      if (status == 401) {
        alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
      } else {
        localStorage.clear();
        alert('ì•Œ ìˆ˜ ì—†ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.');
      }
      window.location.href = '/';
    },
  });
}
```

getSelfí•¨ìˆ˜ëŠ” ajaxë¥¼ í†µí•´ ì„œë²„ì™€ ë¹„ë™ê¸° í†µì‹ ì„ í•œë‹¤. '/api/users/me' ê²½ë¡œë¡œ GET ìš”ì²­ì„ ë³´ë‚´ë©´ ìœ ì € ê´€ë ¨ ì •ë³´ë¥¼ ë°›ëŠ” ê²ƒìœ¼ë¡œ ë³´ì—¬ì§„ë‹¤.  
GET ìš”ì²­ì´ ì„±ê³µí•˜ë©´ callback íŒŒë¼ë¯¸í„°(ì‚¬ì‹¤ìƒ í•¨ìˆ˜)ì— ìœ ì € ì •ë³´ë¥¼ ì „ë‹¬í•´ ì‹¤í–‰ë˜ë„ë¡ í•˜ê³  ìˆìœ¼ë©°, ìš”ì²­ì´ ì‹¤íŒ¨í–ˆì„ ê²½ìš°ì— ëŒ€í•œ ëŒ€ì²˜ë„ ì¡´ì¬í•œë‹¤.

> `xhr?`  
> ìš”ì²­ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ì—ëŸ¬ë¥¼ ë°›ì„ ì‹œ í•´ë‹¹ ìš”ì²­ì— ëŒ€í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆëŠ” XMLHttpRequest (XHR) ê°ì²´ë¥¼ ë°›ê²Œëœë‹¤.

ì •ë¦¬í•˜ìë©´ ajaxë¥¼ í†µí•´ ìœ ì € ì •ë³´ë¥¼ GETí•˜ì—¬ ì„±ê³µí•˜ë©´ ê·¸ ì •ë³´ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•˜ë˜ (ì½œë°±)í•¨ìˆ˜ì— ë‹´ì•„ ì‹¤í–‰ë˜ë„ë¡ í•œë‹¤.

- ìœ ì € ì •ë³´ -> í”„ë¡ íŠ¸ ì ìš© (í”„ë¡ íŠ¸ ë²„íŠ¼ì— ë§ì¶¤ í•¨ìˆ˜ ì ìš©)
