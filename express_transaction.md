# Transaction

íŠ¸ëœì­ì…˜(Transaction)ì€ í•˜ë‚˜ì˜ ì¿¼ë¦¬(ì‘ì—…) ë‹¨ìœ„ë¥¼ í•˜ë‚˜ì˜ ë¬¶ìŒìœ¼ë¡œì„œ ì²˜ë¦¬í•˜ëŠ” ê¸°ëŠ¥ì„ ì˜ë¯¸í•œë‹¤.  
ê°€ë ¹ í†µì¥ ì…ì¶œê¸ˆ ì‹œìŠ¤í…œì˜ ê²½ìš° Aê°€ Bì—ê²Œ 1000ì›ì„ ì†¡ê¸ˆí•˜ëŠ” ì‘ì—…ì„ 1. Aê°€ Bì—ê²Œ ì†¡ê¸ˆí•œë‹¤. 2. Bì˜ ì”ì•¡ì´ 1000ì› ì¦ê°€í•œë‹¤. ì™€ ê°™ì€ ì‘ì—…ì´ ì´ë¤„ì ¸ì•¼ í•˜ëŠ”ë° í•´ë‹¹ ì‘ì—…ì´ ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ë¡œ ì¸í•´ ì¤‘ë‹¨ëœë‹¤ë©´ Aê°€ ë³´ë‚¸ 1000ì›ì´ ì¦ë°œí•  ìˆ˜ë„ ìˆë‹¤. ë°”ë¡œ ì´ëŸ¬í•œ í˜„ìƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ íŠ¸ëœì­ì…˜ì´ ì¡´ì¬í•œë‹¤.

## Transactionì˜ íŠ¹ì§• ACID

**Atomicity(ì›ìì„±)** - ì—¬ëŸ¬ ì¿¼ë¦¬ ëª…ë ¹ë“¤ì„ í•˜ë‚˜ì˜ ì‘ì—… ë‹¨ìœ„ë¡œ ì·¨ê¸‰í•˜ì—¬, ë‚´ë¶€ ì¿¼ë¦¬ ëª…ë ¹ë“¤ì´ ì „ë¶€ ì„±ê³µí•˜ê±°ë‚˜, ì•„ë‹ˆë©´ ëª¨ë‘ ì‹¤íŒ¨í•´ì•¼í•œë‹¤ëŠ” íŠ¹ì§•ì´ë‹¤.
**Consistency(ì¼ê´€ì„±)** - íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ê³¼ì •ì—ì„œ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•´ì•¼í•˜ëŠ” íŠ¹ì§•ì…ë‹ˆë‹¤. ì¦‰ íŠ¸ëœì­ì…˜ì˜ ì„±ê³µ, ì‹¤íŒ¨ì— ë”°ë¼ ë°ì´í„° ë˜í•œ ì²˜ë¦¬ì™„ë£Œ ë˜ëŠ” ì²˜ë¦¬ ì „ ì´ë ‡ê²Œ ì¤‘ê°„ ë‹¨ê³„ ì—†ì´ ì´ë¶„ë²•ì ìœ¼ë¡œ ë°ì´í„°ê°€ ìœ ì§€ ë˜ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤. ì›ìì„±ì´ ì¿¼ë¦¬ ëª…ë ¹ ê·¸ë£¹ì˜ ê´€ì ì—ì„œ ë³¸ë‹¤ë©´ ì¼ê´€ì„±ì€ ë°ì´í„° ì²˜ë¦¬ ê·¸ë£¹ì˜ ê´€ì ì—ì„œ ë³´ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.  
**Isolation(ê²©ë¦¬ì„±)** - íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰í•˜ëŠ” ì¤‘ì—ëŠ” ì™¸ë¶€ì—ì„œ ë°ì´í„°ì— ì ‘ê·¼í•˜ì—¬ ì¤‘ê°„ ìƒíƒœë¥¼ ë³´ê±°ë‚˜ ë³€ê²½í•  ìˆ˜ ì—†ë„ë¡ êµ¬ì„±í•˜ëŠ” íŠ¹ì§•ì…ë‹ˆë‹¤. ë§Œì•½ ê³„ì¢Œ ì´ì²´ë¥¼ ì´ ì„¸ë²ˆí•˜ëŠ” íŠ¸ëœì­ì…˜ì´ ì²˜ë¦¬ ì¤‘ì¸ë° ë‘ ë²ˆì§¸ ê³„ì¢Œ ì´ì²´ ì²˜ë¦¬ í›„ ëˆ„êµ°ê°€ê°€ ì”ì•¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆë‹¤ë©´ ì•ˆë˜ëŠ” ì¼ì´ê¸° ë•Œë¬¸ì— ì‘ì—… ë„ì¤‘ì—ëŠ” í•´ë‹¹ DB ì˜¤ë¸Œì íŠ¸ì— `Lock`ì„ ê±¸ì–´ ë˜ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ì ‘ê·¼ì„ ë§‰ëŠ”ë‹¤. ì´ëŠ” ì—¬ëŸ¬ í´ë¼ì´ì–¸íŠ¸ê°€ í•˜ë‚˜ì˜ DBì— ë™ì‹œì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” **ë™ì‹œì„±(Concurrency)**ì´ ë³´ì¥ë¨ìœ¼ë¡œ ì¸í•´ ë°œìƒí•˜ëŠ” ë¬¸ì œì¸ë° íŠ¸ëœì­ì…˜ ì²˜ë¦¬ ê³¼ì •ì—ì„œëŠ” ë™ì‹œì„± ì´ìŠˆë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰í•œ ìœ ì €ì—ê²Œë§Œ í•´ë‹¹ ë°ì´í„°ë¥¼ ì ìœ í•  ìˆ˜ ìˆë„ë¡ í•˜ëŠ” ê²ƒì´ë‹¤.
**Durability(ì§€ì†ì„±)** - íŠ¸ëœì­ì…˜ì„ ì„±ê³µì ìœ¼ë¡œ ìˆ˜í–‰í–ˆë‹¤ë©´ ìˆ˜ì •ëœ ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜ ë˜ì–´ì•¼ í•œë‹¤ëŠ” íŠ¹ì§•ì´ë‹¤. ì´ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì— ì´ìƒì´ ìƒê²¨ ì¬ë¶€íŒ…ì„ í•œë‹¤ í•˜ë”ë¼ë„ ì´ì „ê¹Œì§€ì˜ íŠ¸ëœì­ì…˜ ë³€ê²½ ì‚¬í•­ì´ ê·¸ëŒ€ë¡œ ë°˜ì˜ë˜ì–´ ì§€ì†ì‹œí‚¬ ìˆ˜ ìˆì–´ì•¼ í•¨ì„ ì˜ë¯¸í•œë‹¤.

## LOCKì˜ ì¢…ë¥˜

í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì´ ìˆ˜í–‰ë˜ëŠ” ë™ì•ˆ ì™¸ë¶€ í´ë¼ì´ì–¸íŠ¸ì˜ ì ìœ ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ìˆ˜ë‹¨ì´ë‹¤.  
ë™ì‹œì„±ì„ ë‹¤ì†Œ í•´ì¹˜ê²Œ ë˜ë”ë¼ë„ ë°ì´í„°ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ê¸° ìœ„í•œ Trade-offë¥¼ ì¡°ì ˆí•˜ê¸° ìœ„í•´ ì—¬ëŸ¬ Lockì˜ ì¢…ë¥˜ê°€ ì¡´ì¬í•œë‹¤.

### Shared and Exclusive Locks

**Shared Lock (ê³µìœ ë½)**ì˜ ê²½ìš° ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì½ê¸°(READ)ëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ ì“°ê¸°(WRITE)ëŠ” ë¶ˆê°€í•˜ë„ë¡ ì œí•œí•˜ëŠ” Lockì´ë‹¤. ëˆ„êµ°ê°€ê°€ ì½ê³  ìˆë‹¤ë©´ ìˆ˜ì •ì´ ë¶ˆê°€í•˜ë©°, READ ì „ìš© LOCKì´ë¼ê³ ë„ í•œë‹¤.  
**Exclusive Lock (ë°°íƒ€ë½)**ì˜ ê²½ìš° ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì´ ì½ê¸°, ì“°ê¸° ëª¨ë‘ ë¶ˆê°€í•˜ë„ë¡ ì œí•œí•˜ëŠ” Lockì´ë‹¤. ëˆ„êµ°ê°€ê°€ ë°ì´í„°ë¥¼ ì ìœ í•˜ê³  ìˆë‹¤ë©´ íƒ€ ì‚¬ìš©ìëŠ” ì ìœ  ìì²´ê°€ ë¶ˆê°€í•˜ë©°, WRITE ì „ìš© LOCKì´ë¼ê³ ë„ ë¶€ë¥¸ë‹¤.

## LOCKING LEVEL

**Global Locks | Database Locks** - `ë°ì´í„°ë² ì´ìŠ¤ì˜ ëª¨ë“  í…Œì´ë¸”ì— ë½`ì„ ê±¸ì–´, í˜„ì¬ íŠ¸ëœì­ì…˜ì„ ì œì™¸í•œ ë‚˜ë¨¸ì§€ íŠ¸ëœì­ì…˜ë“¤ì´ ëª¨ë“  í…Œì´ë¸”ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ë„ë¡ ë§Œë“ ë‹¤. ì¦‰ í•œ ì‚¬ëŒì”© ë°ì´í„° ë² ì´ìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•œë‹¤.  
**Table Locks** - `ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì‘ì—…ì¤‘ì¸ í…Œì´ë¸”ì— ë½`ì„ ê±¸ì–´ í…Œì´ë¸” ë‹¨ìœ„ë¡œ ë™ì‹œì— ìˆ˜ì •í•˜ì§€ ëª»í•˜ë„ë¡ í•œë‹¤.
**Named Locks** - `íŠ¹ì •í•œ ë¬¸ìì—´ì„ ì ìœ í•˜ëŠ” ë½`ì„ ì˜ë¯¸í•œë‹¤.
**Metadata Locks** - `ë‹¤ë¥¸ ì‚¬ìš©ìê°€ ì‘ì—…ì¤‘ì¸ í…Œì´ë¸”ì˜ ë™ì¼í•œ í–‰ê³¼ ë™ì¼í•œ ë°ì´í„°ë² ì´ìŠ¤ì˜ ê°ì²´ì— ë½`ì„ ê±¸ì–´ ë™ì‹œì— ìˆ˜ì •í•˜ì§€ ëª»í•˜ë„ë¡ í•œë‹¤.

> ğŸš¨ `êµì°©ìƒíƒœ`  
> ë½ì„ ì˜ëª» ê±¸ê²Œë˜ë©´ ì•„ë¬´ë„ íŠ¹ì • ë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•  ìˆ˜ ì—†ê²Œ ë˜ëŠ” `êµì°© ìƒíƒœ(Dead Lock)`ì— ë¹ ì§€ê²Œ ëœë‹¤.  
> ê°€ë ¹ A íŠ¸ëœì­ì…˜ì´ aí…Œì´ë¸”ì—ì„œ ì²˜ë¦¬ í›„ b í…Œì´ë¸”ì„ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ì´ê³ , B íŠ¸ëœì­ì…˜ì´ bí…Œì´ë¸” ì²˜ë¦¬ í›„ a í…Œì´ë¸”ì„ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ì´ë¼ê³  í•˜ì  
> Aì™€ Bê°€ ë¹„ìŠ·í•œ ì‹œê¸°ì— íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰í•œë‹¤ë©´ AëŠ” aì²˜ë¦¬ í›„ bë¡œ ê°€ì•¼í•˜ëŠ”ë° Bê°€ bë¥¼ ì ìœ í•˜ê³  ìˆê³ , ë°˜ëŒ€ë¡œ BëŠ” bì²˜ë¦¬ í›„ aë¡œ ê°€ì•¼í•˜ëŠ”ë° Aê°€ aë¥¼ ì ìœ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí•œë‹¤.  
> ê·¸ëŸ¬ë©´ Aì™€ BëŠ” ê°ìì˜ ë‚¨ì€ íŠ¸ëœì­ì…˜ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ ë¬´í•œì • ëŒ€ê¸°í•˜ê²Œ ë˜ëŠ” êµì°© ìƒíƒœì— ë¹ ì§€ê²Œ ëœë‹¤.

## Isolation Level

íŠ¸ëœì­ì…˜ì€ ê²©ë¦¬ ìˆ˜ì¤€ì„ êµ¬ë¶„í•˜ì—¬ ì ‘ê·¼ ê¶Œí•œì˜ ì •ë„ë¥¼ êµ¬ë¶„í•œë‹¤.

`READ UNCOMMITTED` - **ì»¤ë°‹ ë˜ì§€ ì•Šì€ ë°ì´í„°ì˜ ì½ê¸°(Uncommitted Read)ë¥¼ í—ˆìš©**í•˜ëŠ” ê²©ë¦¬ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ì´ëŠ” ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì— ì˜í•´ ì‘ì—… ì¤‘ì¸ ë°ì´í„°ë¥¼ ì½ëŠ” ê²ƒì„ ì˜ë¯¸í•˜ë¯€ë¡œ ì˜ëª»ëœ ì°¸ì¡°ë¥¼ ë¶€ë¥´ê²Œ ëœë‹¤. ì´ëŠ” ê³§ ì¼ê´€ì„±ì´ êº ì§ì„ ì˜ë¯¸í•œë‹¤.  
`READ COMMITTED` - **ì»¤ë°‹ ëœ ì½ê¸°(Committed Read)ë§Œì„ í—ˆìš©**í•˜ê³ , `SELECT` ë¬¸ì„ ì‹¤í–‰í•  ë•Œ ê³µìœ ë½ì„ ê±¸ì–´ ì“°ê¸°ëŠ” ë¶ˆê°€í•œ ìˆ˜ì¤€ì„ ì˜ë¯¸í•œë‹¤.  
`REPEATABLE READ` - **íŠ¸ëœì­ì…˜ì´ ì™„ì „íˆ ì¢…ë£Œë  ë•Œ ê¹Œì§€ ë½ì„ ìœ ì§€**í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‹¤ë¥¸ íŠ¸ëœì­ì…˜ì—ì„œ ë°ì´í„°ë¥¼ ì‚½ì…í•˜ëŠ” ê²ƒì€ ê°€ëŠ¥í•˜ë¯€ë¡œ **íŒ¬í…€ ì½ê¸°**ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¬¸ì œì ì´ ìˆë‹¤. ì—¬ê¸°ì„œ íŒ¬í…€ ì½ê¸°ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ë°ì´í„°ë¥¼ ì°¸ì¡°í•˜ê³  ìˆëŠ” ìƒíƒœë¥¼ ì˜ë¯¸í•œë‹¤. ì¦‰ ëˆ„êµ°ê°€ ë°ì´í„°ë¥¼ ì¤‘ë„ ì‚½ì…í–ˆì§€ë§Œ ì ìœ  ì¤‘ì¸ íŠ¸ëœì­ì…˜ ì²˜ë¦¬ì— ë”°ë¼ ì¦‰ì‹œ ì‚­ì œë  ìˆ˜ë„ ìˆëŠ”ë° ì´ëŸ´ ê²½ìš° í•´ë‹¹ ë°ì´í„°ëŠ” ìˆë‹¤ê³  ì¸ì‹ë˜ì§€ë§Œ ì‹¤ì œí•˜ì§€ ì•Šê²Œ ëœë‹¤.  
`SERIALIZABLE` - **ê°€ì¥ ë†’ì€ ìˆ˜ì¤€ì˜ ê²©ë¦¬ ìˆ˜ì¤€**ìœ¼ë¡œ ì ìœ  ì‹œ ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ëŠ” ì•„ë¬´ ê²ƒë„ ëª»í•œë‹¤. ë™ì‹œì„±ì´ ë–¨ì–´ì§€ëŠ” ë¬¸ì œì ì´ ì¡´ì¬í•œë‹¤.

## MySQL íŠ¸ëœì­ì…˜ ì‚¬ìš©ì˜ ê¸°ë³¸ ì˜ˆì‹œ

```sql
-- MYTABLE í…Œì´ë¸”ì„ ìƒì„±í•©ë‹ˆë‹¤.
CREATE TABLE IF NOT EXISTS MYTABLE
(
    id       INT(11)      NOT NULL PRIMARY KEY AUTO_INCREMENT,
    name     VARCHAR(255) NOT NULL,
    location VARCHAR(255) NOT NULL
);

-- 1ë²ˆì§¸ íŠ¸ëœì­ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
START TRANSACTION;

-- ë§ˆì´ í…Œì´ë¸”ì— ë”ë¯¸ ë°ì´í„° 3ê°œë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
INSERT INTO MYTABLE (name, location)
VALUES ('apple', 'SEOUL'),
       ('ball', 'BUSAN'),
       ('cat', 'DAEGU');

-- 1ë²ˆì§¸ íŠ¸ëœì­ì…˜ì„ DBì— ì ìš©í•©ë‹ˆë‹¤.
COMMIT;


-- 2ë²ˆì§¸ íŠ¸ëœì­ì…˜ì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
START TRANSACTION;

-- ë§ˆì´ í…Œì´ë¸”ì— ë”ë¯¸ ë°ì´í„° 3ê°œë¥¼ ì‚½ì…í•©ë‹ˆë‹¤.
INSERT INTO MYTABLE (name, location)
VALUES ('doll', 'SEOUL'),
       ('egg', 'BUSAN'),
       ('fish', 'DAEGU');

-- 2ë²ˆì§¸ íŠ¸ëœì­ì…˜ì„ ë¡¤ë°±í•©ë‹ˆë‹¤.
ROLLBACK;
```

## Sequelizeë¡œ Transactioní•˜ê¸°

### managedì™€ Unmanaged íŠ¸ëœì­ì…˜

sequelizeì—ì„œ TransactionëŠ” ì–´ë–»ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ì•Œì•„ë³´ì

sequelizeì—ì„œ íŠ¸ëœì­ì…˜ì„ ì ìš©í•˜ëŠ” ë°©ë²•ì€ í¬ê¸° `Managed` ë°©ì‹ê³¼ `Unmanaged` ë°©ì‹ìœ¼ë¡œ ë‚˜ë‰œë‹¤.

```javascript
// Managed
const { sequelize, User } = require('../models');

// íŠ¸ëœì­ì…˜ì˜ ì½œë°±ìœ¼ë¡œ ìœ ì € ìƒì„± ë¡œì§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤
const result = await sequelize.transaction(async (t) => {
  const user = await User.create(
    {
      nickname: 'apple',
      age: 18,
    },
    { transaction: t } // í•´ë‹¹ ë¡œì§ì´ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì—¬ìˆìŒì„ ëª…ì‹œí•¨
  );

  return user;
});
```

ìœ„ ì½”ë“œì—ì„œ ë³´ëŠ” ê²ƒê³¼ ê°™ì´ ë‹¨ìˆœíˆ models/index.jsì—ì„œ sequelizeë¥¼ importí•œ ë’¤ ê¸°ì¡´ì— ì ìš©í•˜ë˜ ìœ ì € ìƒì„± ë¡œì§ì„ ì½œë°± í•¨ìˆ˜ë¡œ ê°ì‹¸ì£¼ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  
unmanagedì™€ ë¹„êµí•˜ë©´ ê¸ˆë°© ì•Œê²Œ ë˜ê² ì§€ë§Œ ìœ„ ì½”ë“œì—ì„œ ìš”ì²­ ì„±ê³µ ë˜ëŠ” ì—ëŸ¬ì— ë”°ë¥¸ `COMMIT`ê³¼ `ROLLBACK` ëª…ë ¹ì´ ë”°ë¡œ ëª…ì‹œë˜ì–´ ìˆì§€ ì•Šì§€ë§Œ ê·¸ëŸ¼ì—ë„ ìì²´ì ìœ¼ë¡œ ë™ì‘í•œë‹¤. ê·¸ë˜ì„œ ì½”ë“œë¥¼ ê°„ê²°í•˜ê²Œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤ëŠ” ì¥ì ì´ ìˆë‹¤.  
í•˜ì§€ë§Œ `ì—ëŸ¬ ìƒí™© ì™¸ ë¡¤ë°±ì´ í•„ìš”í•œ ë¡œì§ì˜ ê²½ìš° ì–´ë–»ê²Œ ì§œì•¼ í•˜ëŠ”ê°€?` ì— ëŒ€í•œ ë¬¸ì œì ì´ ìˆë‹¤. ê°€ë ¹ User ìƒì„± í›„ ìƒì„±ì´ ì˜ ë˜ì—ˆëŠ”ê°€ì— ëŒ€í•œ ê²€ì¦ì„ ê±°ì¹œë‹¤ê³  ê°€ì •í–ˆì„ ë•Œ ë¬¸ì œê°€ ìˆë‹¤ë©´ ë‹¤ì‹œ ë¡¤ë°±ì²˜ë¦¬ ë˜ë„ë¡ ë¡œì§ì„ êµ¬ì„±í•  ìˆ˜ë„ ìˆì„ ê²ƒì¸ë° managedì—ì„œëŠ” ì´ëŸ¬í•œ ì¶”ê°€ ë¡œì§ êµ¬ì„±ì— ìˆì–´ ì œí•œì´ ìˆë‹¤.

```javascript
// Unmanaged
const { sequelize, User } = require('../models');
const { Transaction } = require('sequelize');

// íŠ¸ëœì­ì…˜ì˜ ì½œë°±ìœ¼ë¡œ ìœ ì € ìƒì„± ë¡œì§ì„ ì²˜ë¦¬í•©ë‹ˆë‹¤
const t = await sequelize.transaction({
  isolationLevel: Transaction.ISOLATION_LEVELS.READ_COMMITTED,
});

try {
  const user = await User.create(
    {
      nickname: 'apple',
      age: 18,
    },
    { transaction: t } // í•´ë‹¹ ë¡œì§ì´ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì—¬ìˆìŒì„ ëª…ì‹œí•¨
  );

  await t.commit();
} catch (transactionError) {
  await t.rollback();
}
```

Unmanaged ë°©ì‹ì€ íŠ¸ëœì­ì…˜ì˜ të¥¼ ë³€ìˆ˜ë¡œ ë”°ë¡œ í• ë‹¹í•˜ë©´ì„œ `IsolationLevel(ê²©ë¦¬ ìˆ˜ì¤€)`ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.  
ë˜í•œ commitê³¼ rollbackì„ ëª…í™•í•˜ê²Œ ëª…ì‹œí•˜ê³  ìˆë‹¤ëŠ” ì ì´ managedì™€ì˜ ì°¨ì´ì ì´ë¼ í•  ìˆ˜ ìˆë‹¤. ì´ëŠ” managed ë°©ì‹ê³¼ ë™ì¼í•œ ì‘ë™ë°©ì‹ì„ ë³´ì´ë‚˜ ìš”ì²­ì— ëŒ€í•œ ì„±ê³µê³¼ ì—ëŸ¬ ë°œìƒì— ëŒ€í•œ ëª…í™•í•œ êµ¬ë¶„ì„ ë³´ì´ê³  ìˆìœ¼ë©° íŠ¹íˆ ë©”ì¸ task ì´ì™¸ ì¶”ê°€ì ì¸ taskê°€ í•„ìš”í•  ê²½ìš°ì—ë„ ë¡¤ë°±ì„ ì ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ì ì—ì„œ managedì™€ì˜ ì°¨ë³„ì ì„ ë³´ì¸ë‹¤.  
ê°œì¸ì ìœ¼ë¡œëŠ” í•­ìƒ í˜‘ì—…ì˜ ìƒí™©ì„ ê°€ì •í•œë‹¤ê³  í–ˆì„ ë–„ ì½”ë“œ ê³µìœ ë¥¼ ìœ„í•´ ëª…í™•í•˜ê²Œ ëª…ì‹œë˜ëŠ” ê²ƒì´ ì¢‹ë‹¤ê³  ìƒê°í•˜ë©° ë˜í•œ í™•ì¥ì„±ì„ ê³ ë ¤í–ˆì„ ë•Œ Unmanaged ë°©ì‹ì´ ë” ì„ í˜¸ë˜ì–´ì•¼ í•œë‹¤ê³  ìƒê°í•œë‹¤.

ì´ì œ unmanaged ë°©ì‹ì„ ê¸°ì¤€ìœ¼ë¡œ ì‹¤ì œ ì˜ˆì‹œë¥¼ ì‚´í´ë³´ì  
íšŒì›ê°€ì… taskë¥¼ ìˆ˜í–‰í•˜ëŠ” ê³¼ì •ì—ì„œ ìœ ì € ë¡œê·¸ì¸ ì‹œ í•„ìš”í•œ ì´ë©”ì¼ê³¼ íŒ¨ìŠ¤ì›Œë“œì •ë³´ëŠ” User í…Œì´ë¸”ì— ì €ì¥í•˜ê³ , ê·¸ ì™¸ ìœ ì €ì— ëŒ€í•œ ì •ë³´ëŠ” UserInfo í…Œì´ë¸”ì— ë”°ë¡œ ì €ì¥í•œë‹¤ê³  í–ˆì„ ë•Œ ì•„ë˜ì™€ ê°™ì€ íŠ¸ëœì­ì…˜ì„ ì ìš©í•  ìˆ˜ ìˆì„ ê²ƒì´ë‹¤.

```javascript
// Unmanaged
const { sequelize, User, UserInfo } = require('../models');
const { Transaction } = require('sequelize');
const express = require('express');
const router = express.Router();

router.post('/users', async (req, res) => {
  const { email, password, nickname, name, age, gender } = req.body;

  // íŠ¸ëœì­ì…˜ì„ ì •ì˜í•©ë‹ˆë‹¤.
  const t = await sequelize.transaction({
    isolationLevel: Transaction.ISOLATION_LEVELS.READ_COMMITTED,
  });

  try {
    // ìœ ì €ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    const user = await User.create({ email, password }, { transaction: t }); // íŠ¸ëœì­ì…˜ ë“±ë¡

    // ìœ ì € ì •ë³´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
    const userInfo = await UserInfo.create(
      {
        nickname,
        name,
        age,
        gender,
      },
      { transaction: t } // íŠ¸ëœì­ì…˜ ë“±ë¡
    );

    await t.commit(); // ì„±ê³µ ì‹œ ì»¤ë°‹
  } catch (transactionError) {
    await t.rollback(); // ì‹¤íŒ¨ ì‹œ ë¡¤ë°±
    return res.status(400).send({ message: 'ìœ ì € ìƒì„± ì‹¤íŒ¨' });
  }

  return res.status(201).send({ message: 'ìœ ì € ìƒì„± ì„±ê³µ' });
});
```

ìœ„ ì½”ë“œì™€ ê°™ì´ ë‘ ê°€ì§€ ë‹¤ë¥¸ ëª¨ë¸ì— ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ê²½ìš° í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´ì„œ ì²˜ë¦¬í•˜ë„ë¡ í•¨ì„ ì•Œ ìˆ˜ ìˆë‹¤.  
ê¸°ì–µí•´ì•¼í•  ì ì€ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì¼ ìˆ˜ ìˆë„ë¡ ë°˜ë“œì‹œ ê° ëª¨ë¸ ì ‘ê·¼ taskì— {transaction: t}ë¥¼ ì ìš©í•´ì•¼ í•œë‹¤ëŠ” ì ì´ë‹¤. 